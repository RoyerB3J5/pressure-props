---
import { Icon } from 'astro-icon/components';
---

<div class="flex items-center gap-3 md:gap-[6px]" role="group" aria-label="Cambiar idioma">
  <button 
    type="button"
    aria-label="Cambiar a Español"
    title="Español"
    class="w-[31px] h-[31px] cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 rounded"
    data-lang="es"
  >
    <Icon name="es" class="w-[31px] h-[31px]" aria-hidden="true" />
    <span class="sr-only">Español</span>
  </button>
  <button 
    type="button"
    aria-label="Change to English"
    title="English"
    class="w-[31px] h-[31px] cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 rounded"
    data-lang="en"
  >
    <Icon name="en" class="w-[31px] h-[31px]" aria-hidden="true" />
    <span class="sr-only">English</span>
  </button>
</div>

<style>
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>

<script is:inline>
  document.querySelectorAll('button[data-lang]').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.getAttribute('data-lang');
      sessionStorage.setItem('langScroll', window.scrollY);
      const newPath = window.location.pathname.replace(
        /^\/(es|en)/,
        `/${lang}`
      );
      window.location.href = newPath;
    });
    
    // Agregar soporte para teclado
    btn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        btn.click();
      }
    });
  });
</script>
<script is:inline>
  // Restauración de posición con prevención de parpadeo
  document.addEventListener('DOMContentLoaded', () => {
    const savedPosition = sessionStorage.getItem('langScroll');

    if (savedPosition !== null) {
      // Restaurar posición antes de mostrar contenido
      window.scrollTo({
        top: parseInt(savedPosition, 10),
        behavior: 'instant',
      });
      sessionStorage.removeItem('langScroll');
    }

    // Mostrar contenido después de restaurar posición
    document.body.classList.add('visible');
  });
</script>